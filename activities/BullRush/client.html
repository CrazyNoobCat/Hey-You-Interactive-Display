<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Bull Rush Controller | Hey You, Interact With Me!</title>

    <!--<link rel="manifest" href="/manifest.webmanifest">-->

    <link rel="stylesheet" media="screen"                               href="client_min.css" /> <!-- think of CSS as client/controller-core.css -->
    <link rel="stylesheet" media="screen and (min-device-width: 800px)" href="client.css"     /> <!-- on a desktop => CSS to emulate phone size, shape, and appearance -->

    <link rel="stylesheet" href="bullrush-client.css" />

    <!--
    <style>
        .arrow {
            position: relative;
            display: inline-block;
            width: 49%;
        }

        .inner {
          margin: auto;
          width: 75%;
        }

        .dot, .dotcanvas {
          position: absolute; 
          left:   0px; 
          top:    300px; 
          right:  0px; 
          bottom: 0px;
          margin: auto; 
          height: 120px;
          width:  120px;
        }	
    </style>
    -->
    
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymoous">
    </script>

    <!-- The following degined 'socket' as a global variable -->
    <script type="text/javascript" src="socketCreation.js"></script>

    <script type="text/javascript" src="/scripts/bullrush-utils.js"></script>
    <script type="text/javascript" src="/scripts/bullrush-client.js"></script>
    
    <script>
      // Generic socket setup      
      setupConnection("client");  

      // Following the standard client.html template
      // => Probably not necessary to access roomID, not currently used in code below!
      var roomID = getCookie('roomID');
      console.log("roomID: " + roomID);

      // Page specific functions ...
      function socketLoaded(){
          socket.emit('clientConnected');
	  
          socket.on('playerMarker', (playerCol, playerType, playerLabel) => {
              console.log("For player type '" + playerType + "' Setting colour to: " + playerCol);
	      document.getElementById("stick1-loading").style.display = "none";
	      
	      var canvas = document.getElementById('stick1-canvas');
	      var ctx    = canvas.getContext('2d');
	      
	      canvas.width  = canvas.offsetWidth;
	      canvas.height = canvas.offsetHeight;
	      
	      var xOrg   = canvas.width/2;
	      var yOrg   = canvas.height/2;

	      var minRadius = Math.min(canvas.width,canvas.height)/2;
	      var radius    = minRadius-2; // includesome wiggle room to avoid clipping

	      if (playerType == PlayerType.Runner) {
		  drawRunner(ctx,xOrg,yOrg,radius,playerCol,playerLabel);
	      }
	      else {
		  drawTagger(ctx,xOrg,yOrg,radius,playerCol,playerLabel);
	      }
	      
          });
	  
	  socket.on('playerTaggerContact', () => {
	      console.log("Player-Tagger contact!");
	      navigator.vibrate(1000); // millisecs
	  });

	  /* not currently used */
	  socket.on('displayToControllerMessage', (message) => {
	      console.log("Message from Bullrush Display: " + message);
	  });

	  socket.on('youWin', (message) => {
	      console.log("Message from Bullrush Display: " + message);
	  });	  
	  
          console.log("Socket finished loading");	  
      }
    </script>
    
  </head>

  <body>

    <div class="smartphone">
      <div id="mobile_page">
        <div id="client_header" class="header" style="width: 100%;">

          <button onclick="selectActivity('/')" type="button"><img class="home-img" src="back.svg"></button>
          <h1 class="text">Hey There, Interact With Me!</h1>
          <img class="uni_img" src="uni_logo.svg">
	</div>

	<div class="heading">
	  <h1>Control details</h1>
	  <h2>Treat the circle at the centre of your screen like a joystick</h2>
	  <h2>
	    Touch (or click and hold) on the circle, <br />and:
	  </h2>
	  <ul>
	    <li><i>Drag up</i> to make your Bullrush character (shape) run up</li>
	    <li><i>Drag left</i> to make your Bullrush run to the left</li>
	    <li><i>Drag diagonally up and to the left</i> to make your Bullrush run diagonally</li>
	    <li>Press the <div style="display: inline-block; transform: scale(0.5);"><img class="home-img" src="back.svg" style="padding: 0"></div> button to exit Bullrush, and return to the App Chooser</li>
	  </ul>
	</div>
	
	<div class="controller-item" style="border: none;">
	  <div class="dot">
	    <span id="stick1-loading" class="text">Loading Joystick Control ...</span>
	  </div>
	  <div id="stick1" class="dotcanvas">
	    <canvas id="stick1-canvas" style="width: 100%; height: 100%;">
	      Your browser does not support the HTML5 canvas tag.
	    </canvas>
	  </div>
	</div>
      </div>
    </div>
    
  </body>
</html>
