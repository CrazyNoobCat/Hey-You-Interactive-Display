<!DOCTYPE html>
<html>
<head>
    <title>Slideshow | Hey You Interactive Display</title>
    <style>
        body {
            display: flex;
            justify-content: center;
        }

        video {
            display: none;
        }

        img {
            display: block;
        }

    </style>
    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <script src="/socketCreation.js"></script>
    <!-- Main script for website can be loaded here, should contain a socketUpdate function-->
    <script>
        // Generic socket setup
        setupConnection("display");  
        function socketLoaded(anyListener){
            socket.onAny(anyListener); // Turns on the any listener
            socket.emit("displayLoaded");     

        } 

        window.addEventListener('load', function() {
            vid = document.getElementById("video");
            slide = document.getElementById("slideshow");
            vid.src = '/Slide16.mp4';
            vid.load();
        })
        
        var currentSlide = 1;
        var maxSlides = 16;

        var vid;
        var slide;
        
        function socketUpdate(e, ...args){
            if (e === "next"){
                if (currentSlide < maxSlides)
                    currentSlide++;
                else 
                    currentSlide = 1;

                if (currentSlide == 16){
                    slide.style.display = 'none';
                    vid.style.display = 'block';
                    socket.emit('displayEmit', getCookie('roomID'), 'audio', 'play');
                    vid.play();
                } else{
                    if (vid.style.display === 'block'){
                        vid.style.display = 'none';
                        slide.style.display = 'block'
                        socket.emit('displayEmit', getCookie('roomID'), 'audio', 'reset');
                        vid.load();
                    }
                    slide.src = "/Slide" + currentSlide + '.JPG'; 
                } 

            } else if (e ==="back"){
                if (currentSlide > 1)
                    currentSlide--;
                else 
                    currentSlide = maxSlides;

                if (currentSlide == 16){
                    slide.style.display = 'none';
                    vid.style.display = 'block';
                    socket.emit('displayEmit', getCookie('roomID'), 'playAudio');
                    vid.play();
                } else{
                    if (vid.style.display === 'block'){
                        vid.style.display = 'none';
                        slide.style.display = 'block'
                        socket.emit('displayEmit', getCookie('roomID'), 'audio', 'reset');
                        vid.load();
                    }
                    slide.src = "/Slide" + currentSlide + '.JPG';  

                }
                

            } else if (e === "max"){
                maxSlides = args[0];
            } else if (e ==="download"){
                console.log(args);
                if (currentSlide == 16)
                    socket.emit('displayEmit', args[0], 'download', vid.src );
                else
                    socket.emit('displayEmit', args[0], 'download', slide.src );
            }
        }
    </script>

</head>
<body>      

    <!--<iframe src="https://docs.google.com/presentation/d/e/2PACX-1vTY4no8CYlRv7WvSRAZ01r1b3SR9GhQB4f0-djjd0Q-coWWGDO3WzQZuaOgtlx5tPz6prwkoKa-i84D/embed?start=true&loop=true&delayms=5000" frameborder="0" width="1440" height="839" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>-->

    <img id="slideshow" src="/Slide1.JPG">
    <video id='video' width="500px" height="500px" 
        muted > 
          
        <source id='video'
            type="video/mp4"> 
    </video> 


    <footer>
        <script src="receiver.js"></script>
    </footer>
</body>
</html>