<!DOCTYPE html>
<html>
<head>
    <title>Slideshow | Hey You, Interact With Me!</title>
    <style>
        body {
            display: flex;
            justify-content: center;
        }

        video {
            display: none;
        }

        img {
            display: block;
        }

    </style>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>    
    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <script src="/socketCreation.js"></script>
    <!-- Main script for website can be loaded here, should contain a socketUpdate function-->
    <script>
        // Generic socket setup
        function socketLoaded(anyListener){
            vid = document.getElementById("video");
            slide = document.getElementById("slideshow");            

            socket.onAny(anyListener); // Turns on the any listener
            socket.emit("displayLoaded"); 

            vid.src = '/Slide16.mp4';
            vid.load();
            
            var nric = self.location.host;
            var url = 'https://api.qrserver.com/v1/create-qr-code/?data=' + nric + '/join/' + getCookie('roomID') + '&size=250x250';
	        var $img = $('<img>').attr('src',url);
            $('#barcode').html($img)

        } 
            
        setupConnection("display");  
        
        var currentSlide = 1;
        var maxSlides = 16;

        var vid;
        var slide;
        
        function socketUpdate(e, ...args){
            if (e === "next"){
                if (currentSlide < maxSlides)
                    currentSlide++;
                else 
                    currentSlide = 1;

                if (currentSlide == 16){
                    slide.style.display = 'none';
                    vid.style.display = 'block';
                    socket.emit('displayEmit', getCookie('roomID'), 'audio', 'play');
                    vid.play();
                } else{
                    if (vid.style.display === 'block'){
                        vid.style.display = 'none';
                        slide.style.display = 'block'
                        socket.emit('displayEmit', getCookie('roomID'), 'audio', 'reset');
                        vid.load();
                    }
                    slide.src = "/Slide" + currentSlide + '.JPG'; 
                } 

            } else if (e ==="back"){
                if (currentSlide > 1)
                    currentSlide--;
                else 
                    currentSlide = maxSlides;

                if (currentSlide == 16){
                    slide.style.display = 'none';
                    vid.style.display = 'block';
                    socket.emit('displayEmit', getCookie('roomID'), 'audio', 'play');
                    vid.play();
                } else{
                    if (vid.style.display === 'block'){
                        vid.style.display = 'none';
                        slide.style.display = 'block'
                        socket.emit('displayEmit', getCookie('roomID'), 'audio', 'reset');
                        vid.load();
                    }
                    slide.src = "/Slide" + currentSlide + '.JPG';  

                }
                

            } else if (e === "max"){
                maxSlides = args[0];
            } else if (e ==="download"){
                console.log(args);
                if (currentSlide == 16)
                    socket.emit('displayEmit', args[0], 'download', vid.src );
                else
                    socket.emit('displayEmit', args[0], 'download', slide.src );
            }
        }
    </script>

</head>
<body>      
    <img id="slideshow" src="/Slide1.JPG">
    <video id='video' width="500px" height="500px" 
        muted > 
          
        <source id='video'
            type="video/mp4"> 
    </video> 

    <div id="barcode" style="height: 250px; display: block; position: absolute; right: 7px; top: 7px;"></div>

    <footer>
        <script src="receiver.js"></script>
    </footer>
</body>
</html>
