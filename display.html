<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      
      <title>App Launcher Display | Hey You, Interact With Me!</title>
      
      
      <link rel="icon" href="logo/heyyou-fav.ico" sizes="any" />
      
      <!--<link rel="manifest" href="/manifest.webmanifest">-->
      
      <!-- Cast Debug Logger -->
      <!--<script src="//www.gstatic.com/cast/sdk/libs/devtools/debug_layer/caf_receiver_logger.js"></script>-->
      <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
      
      <link rel="stylesheet" type="text/css" href="display-util.css">
      <link rel="stylesheet" type="text/css" href="display.css">
      <link rel="stylesheet" type="text/css" href="/style/csshake.min.css" />
      
      <script type="text/javascript" src="/scripts/jquery-1.11.2.min.js"></script>
      <script type="text/javascript" src="socketCreation.js"></script>      
      
      <script type="text/javascript" src="/scripts/display-utils.js"></script>
      
      <script>
	var QRDim = null;
	
	// Custom socketLoaded() for top-level activity launcher	
	function socketLoaded(anyListener)
	{
	    var displayHost = self.location.host;
	    
	    console.log("socketLoaded(): Display hostname: " + displayHost);
	    console.log("socketLoaded(): Room ID: " + getCookie('roomID'));
	    
	    Socket.on('setNewCookieMins', (cName, cContent, cDurationMins) => {
		if (cName == "roomName") {
		    displayRoomURL(displayHost,cContent,"join-room-url");
		}
	    });
	    
	    var roomID = getCookie('roomID');
	    displayRoomQRCode(displayHost,roomID,QRDim,"qrcode");
	    
	    if (getCookie('roomName') != "") {
		console.log("socketLoaded(): roomName = " + getCookie('roomName'));
		
		var roomName = getCookie('roomName');
		displayRoomURL(displayHost,roomName,"join-room-url");
	    }
	    else {
		console.log("socketLoaded(): roomName not defined");
	    }
	}
	
	// $(window).width() and window.height() are available from the get-go (i.e., don't need to wait for DOM ready)
	
	var _viewportXDim = $(window).width();
	var _viewportYDim = $(window).height();

	QRDim = computeQRDimMaximizeHeight(_viewportXDim,_viewportYDim);
	
	function displaySelectActivity(activity,optUrlParams)
	{
	    Socket.emit("displaySelectActivity", RoomID, activity, optUrlParams, (response) => {
		//console.log("Redirecting to " + activity);
		//window.location.pathname = '/activity'; // Consider passing on the optUrlParms to the client web page also?
	    });   
	}
	

	var randomActivities = [
	    { "activity": "/slideshow", "optUrlParams": "slidedeck=waikato-uni-backgrounds"},
	    { "activity": "/slideshow", "optUrlParams": "slidedeck=smoke-and-mirrors-sampler"},
	    { "activity": "/bullrush",  "optUrlParams": null }
	];

	var launchRandomActivityTimeout = null;
	function launchRandomActivity()
	{
	    console.log("**** launchRandomActivity called");
	    var randomActivity = randomActivities[0];
	    displaySelectActivity(randomActivity.activity,randomActivity.optUrlParams);

	    //setCookieMins("activity",randomActivity.activity,DisplayCookieTimeoutMins);
	    //Socket.emit("reload", randomActivity.optUrlParams)
	}
	
	$(document).ready(function () {
	    var logoDim = Math.min(QRDim,250)
	    
	    $('#branding-logo').width(logoDim);
	    $('#branding-logo').height(logoDim);
	    
	    $('#qrcode').width(QRDim);
	    $('#qrcode').height(QRDim);
	    $('#qrcode-loading').width(QRDim);
	    $('#qrcode-loading').height(QRDim);


	    launchRandomActivityTimeout = setTimeout(launchRandomActivity, 60 * 1000); // After 60 secs
	    
	});
	
	// All displays need to defined a socketLoaded() function,
	// and call socketConnection("display") to kick things off
	
	setupConnection("display");
	
      </script>
      
    </head>
    
    <body id="xfade" style="background-color: white;">
      <!-- figure elements used for x 4 background image cross-fades (xfade) -->
      <figure></figure>
      <figure></figure>
      <figure></figure>
      <figure></figure>

      <div class="center" style="width: 50%; z-index: 1;">
            <h1 id="heading" class="shake-constant shake-chunk">Scan me to select an interactive app!</h1>
            <div id="frame" class="frame">
	      <div id="branding-logo" class="center" style="align-content: center; margin: auto;">
		<img src="logo/Hey-You-Logo-unired-screen.svg" />
	      </div>
	      <div class="center" style="position: relative; align-content: center; margin-top: 3px;">
		<div id="qrcode-loading" style="position: absolute; z-index: 1; width: 100%; text-align: center; background-color: #f8f8f8;">
		  Loading ...
		</div>
		<div id="qrcode" style="position: relative; z-index: 2;">
		</div>
	      </div>
            </div>                        
            <h2 id="join-room-url">Or visit on your phone:</h2>
        </div>
        <footer>
          <script src="/scripts/receiver.js"></script>	    
        </footer>
    </body>
</html>
